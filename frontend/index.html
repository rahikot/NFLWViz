<!DOCTYPE html>
<html>
<head>
  <title>NFL Visualization</title>
  <meta charset="utf-8">
  <script type="text/javascript" src="lib/d3.v5.min.js"></script>
  <script type="text/javascript" src="visualizeGameData.js"></script>
  <script type="text/javascript" src="lib/d3-simple-slider.js"></script>
</head>

<body>
  <h1>NFL Play Visualization</h1>

  <div id="output"></div>

  <script>

    const margin = { top: 20, right: 20, bottom: 20, left: 20 };
    const width = 960 - margin.left - margin.right;
    const height = 960 - margin.top - margin.bottom;

    // all svg's should be inside mainSvg
    const mainSvg = d3.select("#output")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    const imageUrl = 'NFLField.png'; // Replace with the path to your image file

    // Append the image to the mainSvg
    image = mainSvg.append("image")
        .attr("xlink:href", imageUrl)
        .attr("x", 0) // X-coordinate of the image
        .attr("y", 100) // Y-coordinate of the image
        .attr("width", 900) // Width of the image
        .attr("height", 500); // Height of the image


      var football = mainSvg.append("rect")
              .attr("x", 81) // X-coordinate of the square
              .attr("y", 535) // Y-coordinate of the square
              .attr("width", 10) // Width of the square
              .attr("height", 10) // Height of the square
              .attr("fill", "brown"); // Fill color of the square

    bottomLeft = [81, 535]
    topRight = [816 , 155]

    // svg holding name of teams (TODO: add score and which is home/away team)
    const textSvg = mainSvg.append("svg")
      .attr("x", 240)
      .attr("y", 50)
      .attr("width", 500)
      .attr("height", 200);

    displayTeams(textSvg, "TB", "DAL")

    /* Slider code which may be useful later?
    var sliderGroup = mainSvg.append('g')
    .attr('transform', 'translate(0,600)');

    var slider = d3.sliderHorizontal()
        .width(900)
        .ticks(5)
        .displayValue(false)
        .on('onchange', function(val) {
            d3.select('#value').text(val);
        });

     //plotTicks(slider, scaledData)

     */

    //Note: this does not include all columns, some were excluded since I didn't see their use
    d3.csv("week1.csv", function(d) {
      return {
        gameId: +d.gameId,
        playId: +d.playId,
        frameId: +d.frameId,
        time: new Date(d.time),
        team: d.team,
        playDirection: d.playDirection,
        x: +d.x,
        y: +d.y,
        s: +d.s,
        a: +d.a,
        dis: +d.dis,
        o: +d.o,
        dir: +d.dir,
        event: d.event
      };
    }).then(function(data) {

      let dataByGameId = {}

      data.forEach((row, index) => {
          const gameId = row.gameId;
          const playId = row.playId;
          newCoordinates = scaleCoordinates(row.x, row.y)
          row.x = newCoordinates[0];
          row.y = newCoordinates[1];

          if (!dataByGameId[gameId]) {
              dataByGameId[gameId] = {};
          }

          if (!dataByGameId[gameId].rows) {
              dataByGameId[gameId].rows = {};
          }

          if (!dataByGameId[gameId].rows[index]) {
            dataByGameId[gameId].rows[index] = []
          }
          dataByGameId[gameId].rows[index].push(row);

          if (!dataByGameId[gameId].playIdToRows) {
              dataByGameId[gameId].playIdToRows = {};
          }

          if (!dataByGameId[gameId].playIdToRows[playId]) {
              dataByGameId[gameId].playIdToRows[playId] = [];
          }

          dataByGameId[gameId].playIdToRows[playId].push(row);
      });


      var TBvsDALGame = dataByGameId[2021090900]
      console.log(TBvsDALGame)
      var playData = TBvsDALGame.playIdToRows
      console.log(playData)
      var specificPlays = 480
      var interval = 20

      visualizePlay(playData, specificPlays, football, interval);
    });

  </script>
</body>
</html>

